---
title: "Save"
output: html_document
date: "2023-10-10"
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r, message=FALSE}

libs_1<-c("tidyverse","knitr","psych","reshape2","rmarkdown")

#data manipulation/exploration
libs_2<-c("readxl","readr","tidyr","GGally","naniar","readr")


# plotting
libs_3<-c("ggplot2","viridis","ggpubr","cowplot")#,"ggthemr") 

#ggpubr = package for publishing
#cowplot=  #to create compounded figures

#tables
libs_4<-c("dplyr","stargazer","xlsx","ggplot2","scales","extrafont","writexl")


libs<-c(libs_1,libs_2,libs_3,libs_4)


lapply(libs,require, character.only=TRUE)

library(dplyr)
library(purrr)
library(gridExtra)
```

```{r}
getwd()

Background_ele<-read.delim("211008_0.1M_NaCl_0.05mL_min.TXT",header = TRUE, sep = "")

Background_ele<-data.frame(Background_ele[1:85,])

Background_ele[] <- lapply(Background_ele, function(x) as.numeric(as.character(x)))

#write_xlsx(Background_ele,"/Users/soliverfusi/OneDrive/Desktop/Fusi/Acid_Base_Titration/Titration/Background_ele.xlsx")
```

```{r}
files <- list.files("Base_Acid_Separate_Titration", full.names = TRUE)
str(files)
```

### Gathering Titration Data

```{r}

the_names<- data.frame(list.files(path="Base_Acid_Separate_Titration", pattern="*.TXT", full.names=TRUE)) 

colnames(the_names)=("ID")

the_names_1<-the_names%>%
  mutate(ID=substr(ID, 30,41))


list_1 <- list.files(path="Base_Acid_Separate_Titration", pattern="*.TXT", full.names=TRUE) %>% 
  lapply(read.csv,header=TRUE, sep="",col.names=c("Sample","Vol_Titrant","pH","Time_s","dpH_dt")) %>%
  lapply(head,-28)

#converts the "oo" chatacter into NA, and the remainder of the dataframe into numeric
list_1 <- lapply(list_1, function(d) {
  d[1:5] <- lapply(d[1:5], as.numeric); d
  })

saveRDS(list_1, file="Titration_together.rds")
```

\*currently choosing to retain things as a list because the length of each titration is different

-   metadata: starts with "Date" and ends with " Status: 128" and is the last 22 lines

### Mol OH-, Concentration H+, OH-, Volume Solution, Apparent Net Proton Charge

-   H+ = (for now) 10\^-pH

```{r}
#defining simplified relationship between pH and [H+]


mol_OH_or_H_added_func<-function(x){
  (0.1*x)/1000
}

ten_to<-function(x){
  10^-x
}

conc_OH_func<-function(x){
  (10^-14)/(10^-x)
}

vol_sol_func<-function(x){
  (30+x)/1000
}

net_app_H_func <- function(dataframe) {
  net_app_H<-as.data.frame(((-1*dataframe$H_Conc*dataframe$vol_soln)-dataframe$mol_OH+(dataframe$OH_Conc*dataframe$vol_soln))*1000)
  #return(data.frame(net_app_H = net_app_H))
}

#mol_OH or H added
mol_OH_or_H<-list_1 %>%
  lapply("[",2) %>%
  lapply(mol_OH_or_H_added_func) 
  
H_Conc<- list_1 %>%
  lapply("[",3) %>%
  lapply(ten_to)

OH_Conc<- list_1 %>%
  lapply("[",3) %>%
  lapply(conc_OH_func)

vol_soln<-list_1 %>%
  lapply("[",2) %>%
  lapply(vol_sol_func) 

list_2<-mapply(cbind, mol_OH_or_H, H_Conc,OH_Conc,vol_soln, SIMPLIFY=FALSE)
names_col<-c("mol_OH_or_H","H_Conc","OH_Conc","vol_soln")
list_2<-lapply(list_2, setNames, names_col)

list_3<-mapply(cbind,list_1,list_2, SIMPLIFY=FALSE)

# Call the custom function using lapply to apply it to each dataframe
net_app_H<- lapply(list_3, net_app_H_func)
net_app_H<-lapply(net_app_H, setNames,"net_app_H")
  
list_4<-mapply(cbind,list_3,net_app_H, SIMPLIFY=FALSE)
#lapply("[", , names_col) %>% #extracts the 4 columns 
  #explanation: https://stackoverflow.com/questions/47443365/how-to-extract-certain-columns-from-a-list-of-data-frames 

```

```{r}
# Sample 'names' dataframe

naming<-as.character(seq(1,74))

names_df <- data.frame(
  dataframe = naming,
  identity = the_names_1
)


# Create an empty list to store the named dataframes
list_5 <- list()

# Assign names to the dataframes in the results list
for (i in 1:length(list_4)) {
  dataframe_name <- names_df$ID[i]
  list_5[[dataframe_name]] <- list_4[[i]]
}

# Combine the result dataframes and add a column to distinguish between dataframes

#bind_rows function in the dplyr package is used to combine multiple dataframes into a single dataframe by stacking them on top of each other.

#.id = "ID" specifies that a new column named "ID" should be added to the combined dataframe. This column will contain information about the source dataframe for each 

net_app_combined <- bind_rows(list_5, .id = "SSN") 

output_vars<-read_excel("/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Isotherm_FTIR/IR_Dependent_Variables.xlsx")


# Function to find the matching sample ID
find_matching_sample <- function(id, df2) {
  for (sample_id in df2$SSN) {
    if (grepl(sample_id, id)) {
      return(sample_id)
    }
  }
  return(NA)
}

# Merge df1 and df2 based on partial string matching
df_6 <- net_app_combined %>%
  mutate(matched_sample = sapply(SSN, find_matching_sample, output_vars))

# Merge the data based on the matched_sample column
df_6 <- left_join(df_6, output_vars, by = c("matched_sample" = "SSN"))

# Remove the temporary matched_sample column
df_6 <- df_6 %>%
  select(-matched_sample)

```

## Correcting for Ionic Strength

Libraries

```{r}
library(CHNOSZ)
library(readxl)
```

```{r}
Ions <- read_excel("Base_Acid_Separate_Titration/End_Anion_Concentration.xlsx")
Cations<- read_excel("Base_Acid_Separate_Titration/Acid_Base_Titration_Cations.xlsx")

#I think I accidentally mislabeled the sample NaOH, it should actually be the HCl sample (because NaOH wouldn't have Cl in it)

Ions_1<-Ions[c(14:93),c(2,7)]
Cations_1<-Cations[c(1:75),]

colnames(Ions_1)<-c("SSN","Cl_mg_L")
colnames(Cations_1)<-c("SSN","Na_mg_L")

Ions_2<-Ions[c(95:98),c(2,7)]
Cations_2<-Cations[c(76:81),]

colnames(Ions_2)<-c("SSN","Cl_mg_L")
colnames(Cations_2)<-c("SSN","Na_mg_L")

Ions_1 <- Ions_1 %>% filter(SSN != "MQ") %>%
  filter(SSN != "RESET")



```

#### 3rd Dec 2024 edit

corecting single replicate for AO20

```{r}

# Add a new row to the Ions_1 dataframe
Ions_1 <- rbind(Ions_1, data.frame(SSN = "AO20A", Cl_mg_L = 12495.657069999999))

```

Converting Units from mg/L to mol Cl

```{r}

MW_Cl <- 35.453
MW_Na <-22.990

Ions_1 <- Ions_1 %>% mutate(Cl_mg_L = as.numeric(Cl_mg_L)) %>%
  mutate(Cl_mol_L = Cl_mg_L / MW_Cl/1000/3) 

Cations_1 <- Cations_1 %>% mutate(Na_mg_L = as.numeric(Na_mg_L)) %>%
  mutate(Na_mol_L = Na_mg_L / MW_Na/1000/2) #correcting for dilution factor of 2 

#changing the ID format from, e.g. AK05A to AK_05_A
Ions_1$SSN <- gsub("([A-Z]+)(\\d+)([A-Z]+)", "\\1_\\2_\\3", Ions_1$SSN)
Cations_1$SSN <- gsub("([A-Z]+)(\\d+)([A-Z]+)", "\\1_\\2_\\3", Cations_1$SSN)

Ions_2 <- Ions_2 %>% mutate(Cl_mg_L = as.numeric(Cl_mg_L)) %>%
  mutate(Cl_mol_L = Cl_mg_L / MW_Cl/1000/3)

Cations_2 <- Cations_2 %>% mutate(Na_mg_L = as.numeric(Na_mg_L)) %>%
  mutate(Na_mol_L = Na_mg_L / MW_Na/1000/2) 


#TEMPORARILY: dividing by this factor of 3 until I can identify the source of what seems like an error

```

Currently noticing that the NaCl solution, for instance, which should have a concentration of 0.1M is reading about 0.35M ... unclear if this is a dilution error or what.

-   So, there seems to be an issue of a factor of 3...

```{r}

#Adding the Cl concentration to the main dataframe ... 

df_7 <- df_6 %>%
  mutate(matched_sample = sapply(SSN, find_matching_sample, Ions_1))

df_cat <- df_6 %>%
  mutate(matched_sample = sapply(SSN, find_matching_sample, Cations_1))

# Merge the data based on the matched_sample column
df_7 <- left_join(df_7, Ions_1, by = c("matched_sample" = "SSN"))

df_cat_an <- left_join(df_7, Cations_1, by = c("matched_sample" = "SSN"))

# Remove the temporary matched_sample column
df_7 <- df_cat_an %>%
  select(-matched_sample) %>%
  select(-Cl_mg_L) %>%
  select(-Na_mg_L)
```

## Calculating Activity Coefficient

```{r}


net_app_H_func_corrected <- function(dataframe) {
  net_app_H_corrected<-as.data.frame(((-1*dataframe$H_Conc_corrected*dataframe$vol_soln)-dataframe$mol_OH_or_H+(dataframe$OH_Conc*dataframe$vol_soln))*1000)
  #return(data.frame(net_app_H = net_app_H))
}

#correcting formula for mol strong acid added (here )
net_app_H_func_acid_corrected <- function(dataframe) {
  net_app_H_corrected<-as.data.frame(((-1*dataframe$H_Conc_corrected*dataframe$vol_soln)+dataframe$mol_OH_or_H+(dataframe$OH_Conc*dataframe$vol_soln))*1000)
  #return(data.frame(net_app_H = net_app_H))
}

#adding the Activity Coefficient
df_7 <- df_7 %>%
  mutate(Ionic_Strength = 0.5 * (((1^2)*Na_mol_L)+((-1)^2*Cl_mol_L))) %>%
  mutate(gamma = 10^(-0.509*sqrt(Ionic_Strength))) %>%
  mutate(H_Conc_corrected = (10^((-1)*pH))/gamma)

#correcting for both activity and using the two diff equations depending on whether it's and acid or a base titration 

df_ACID<-df_7 %>%
    filter(str_detect(SSN,"_ACID")) %>%
  mutate(net_app_H_corrected = net_app_H_func_acid_corrected(.)) %>%
  rename_at(26, ~ "net_app_H_corrected") %>% 
  mutate(net_app_H_corrected = as.numeric(unlist(net_app_H_corrected)))
 # rename_with(~ "net_app_H_corrected", .cols = 26)


df_BASE<-df_7 %>%
    filter(str_detect(SSN,"_BASE")) %>%
  mutate(net_app_H_corrected = net_app_H_func_corrected(.)) %>%
  rename_at(26, ~ "net_app_H_corrected") %>% 
  mutate(net_app_H_corrected = as.numeric(unlist(net_app_H_corrected)))

df_8<-rbind(df_ACID,df_BASE)
df_8$SSN<-as.factor(df_8$SSN)

# Create a new column identifying type (AK) and ID (AK_05)
df_8$Type <- substr(df_8$SSN, start = 1, stop = 2)
df_8$Type_ox <- substr(df_8$SSN, start = 1, stop = 5)
df_8$AC_BA <- substr(df_8$SSN, start = 9, stop = 12)

```

### Derivative (Q vs pH)

First

```{r}

df_8 <- df_8 %>%
  group_by(SSN) %>%
  group_modify(~mutate(.x, dQ_dpH = c(NA, diff(net_app_H_corrected) / diff(pH))))

#replacing infinity (i.e. no change in pH, with NA)

df_8  <- df_8 %>% mutate(dQ_dpH = ifelse(is.infinite(dQ_dpH), NA, dQ_dpH))

```

Second

```{r}

df_8 <- df_8 %>%
  group_by(SSN) %>%
  group_modify(~mutate(.x, d2Q_dpH2 = c(NA, diff(dQ_dpH) / diff(pH))))

#replacing infinity (i.e. no change in pH, with NA)

df_8  <- df_8 %>% mutate(d2Q_dpH2 = ifelse(is.infinite(d2Q_dpH2), NA, d2Q_dpH2))
```

### Blank Correction

```{r}

blank_NaCl<- read.csv("Base_Acid_Separate_Titration/Water_Blank.csv")

names(blank_NaCl) <- c("Vol_Titrant","pH")

#mol_OH or H added
blank_NaCl_df<-blank_NaCl %>%
  mutate(mol_OH_or_H = mol_OH_or_H_added_func(.[[1]])) %>%
  mutate(H_Conc = ten_to(.[[2]])) %>%
  mutate(OH_Conc = conc_OH_func(.[[2]])) %>%
  mutate(vol_soln = vol_sol_func(.[[1]])) 

net_app_H_tot <- net_app_H_func(blank_NaCl_df)
net_app_H_tot_1 <- data.frame(net_app_H_total = net_app_H_tot[[1]])

blank_NaCl_df$net_app_H_corr <- net_app_H_tot_1$net_app_H_total-net_app_H_tot_1$net_app_H_total[1]

# Interpolate blank data to match the pH values of the sample data
#interpolated_blank <- approx(blank_NaCl_df$pH, blank_NaCl_df$net_app_H_corr, xout = df_8$pH)$y

interpolated_blank <- approx(blank_NaCl_df$pH, blank_NaCl_df$net_app_H_corr, xout = df_8$pH, rule = 2)$y


# Combine the interpolated blank data with the sample data
df_8$interpolated_blank_charge <- interpolated_blank

# Subtract the interpolated blank charge from the sample charge
df_8$net_app_fin <- df_8$net_app_H_corrected - df_8$interpolated_blank_charge

```

```{r}

ALL_no_AL<-df_8 %>%
  filter (Type != "AL")

```

## \*\*\* (Final) Plot of all duplicated of both acid and base titrations

```{r, warning=FALSE}

plot_all <- ggplot(ALL_no_AL, aes(x = pH, y = net_app_H_corrected, color = O_C)) +
  geom_point(shape = 16, size = 5) +
  labs(
    x = "pH",
    y = "Net Apparent Proton Charge \n (mmolc /g biochar)"
  ) +
  theme_classic(base_size = 30) +  # Increased base font size by 2 points
  theme(
    text = element_text(family = "Helvetica"),  # Changed font to sans-serif
    legend.position = c(0.68, 0.72),  # Adjusted to a valid position within [0, 1]
    axis.text.x = element_text(size = 26),  # Increased font size
    axis.text.y = element_text(size = 26),
    axis.title.x = element_text(margin = margin(t = 20), size = 26),
    axis.title.y = element_text(margin = margin(r = 20), size = 26),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 22),  # Increased font size
    legend.title = element_text(size = 26),
    legend.direction = "horizontal",
    legend.key.width = unit(1.5, "cm"),
    legend.box.margin = margin(t = 5, r = 8, b = 5, l = 5),
    legend.box.background = element_rect(color = "black", size = 2, linetype = "solid")  # Adjusted thickness to match plot
  ) +
  scale_color_gradient(low = "orange", high = "blue", name = "OC") +  # Continuous color gradient
  annotate("text", x = 11, y = 0.13, label = "A", size = 10, fontface = "bold")

ggsave(filename = "pH_Net_App_plot.png", plot = plot_all, width = 10, height = 8, dpi = 300)

# Display the plot
plot_all

```

```{r}

# Apply the formatting from Q_Conc_Dose_Plot to plot_all
plot_all <- ggplot(ALL_no_AL, aes(x = pH, y = net_app_H_corrected, color = O_C)) +
  geom_point(shape = 24, size = 6, stroke = 2, color = "black") +  # Match point size, shape, and outline
  labs(
    x = "pH",
    y = "Net Apparent Proton Charge (mmolc /g biochar)"
  ) +
  theme_classic(base_size = 30) +  # Set base font size
  theme(
    text = element_text(family = "Helvetica"),  # Use the same font
    legend.position = c(0.30, 0.87),  # Position the legend
    axis.text.x = element_text(size = 26),  # Set font size for x-axis text
    axis.text.y = element_text(size = 26),  # Set font size for y-axis text
    axis.title.x = element_text(margin = margin(t = 20), size = 26),  # Set x-axis title with margin
    axis.title.y = element_text(margin = margin(r = 20), size = 26),  # Set y-axis title with margin
    panel.border = element_rect(color = "black", fill = NA, size = 3),  # Set panel border
    legend.text = element_text(size = 22),  # Increase legend text size
    legend.title = element_text(size = 26),  # Increase legend title size
    legend.direction = "horizontal",  # Set legend direction
    legend.key.width = unit(1.5, "cm"),  # Adjust legend key width
    legend.box.margin = margin(t = 5, r = 8, b = 5, l = 5),  # Adjust legend box margin
    legend.box.background = element_rect(color = "black", size = 2, linetype = "solid")  # Match legend box background
  ) +
  scale_color_gradient(low = "orange", high = "blue") +  # Color gradient matching first plot
  guides(color = "none") +  # Remove the legend for color
  scale_x_continuous(expand = c(0, 0)) +  # Adjust x-axis limits (no expansion)
  scale_y_continuous(expand = c(0, 0))  # Adjust y-axis limits (no expansion)

# Display the plot
plot_all

```

```{r, warning=FALSE}

plot_all <- ggplot(ALL_no_AL, aes(x = pH, y = net_app_fin, color=O_C)) +
  geom_point(shape=16, size=5) +
  #scale_color_viridis()+
  labs(#title = "Combined Acid-Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge (mmolc /g biochar)") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 24), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =24),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank(),
       legend.position = "none"  # Remove the legend
    )+
    scale_color_gradient(low = "purple", high = "yellow")
plot_all  
```

```{r}

#subselecting the samples based on acid or base and replicate

titr_A_base<-df_8%>%
  filter(str_detect(SSN,"A_BASE"))

titr_B_base<-df_8%>%
  filter(str_detect(SSN,"B_BASE"))

titr_C_acid<-df_8%>%
  filter(str_detect(SSN,"C_ACID"))

titr_D_acid<-df_8%>%
  filter(str_detect(SSN,"D_ACID"))

```

### Net App at 3 and 11

```{r}

# Extracting the desired values

result <- df_8 %>%
  filter(Sample == max(Sample)) %>%
  group_by(SSN) %>%
  summarise(net_app_fin = first(net_app_fin),
            Type_ox =Type_ox
            )

```

### Net App Difference between pH 3 and pH 11

```{r}

# Load the dplyr library if not already loaded
library(dplyr)


# Find the maximum sample number for each group
max_samples <- ALL_no_AL %>%
  group_by(SSN) %>%
  summarise(
    max_sample = max(Sample, na.rm = TRUE),
    net_app_H_max = net_app_fin[which.max(Sample)]
  )


max_samples  <- max_samples  %>%
  mutate(
    Type_ox = gsub("_[A-D]_[A-Z]+$", "", SSN)  # Extract the common part of SSN
    #group_num = as.numeric(gsub("[^0-9]", "", SSN))  # Extract the numeric part of SSN
  )

# net apparent difference between acid and base 
net_app_diff_df <- max_samples %>%
  group_by(Type_ox) %>%
  filter(grepl("_C_ACID", SSN) | grepl("_A_BASE", SSN)) %>%
  summarise(
    net_app_H_diff_C_A = net_app_H_max[grepl("_C_ACID", SSN)] -
                      net_app_H_max[grepl("_A_BASE", SSN)]
  )

net_app_diff_df  <- net_app_diff_df  %>%
  left_join(
    max_samples %>%
      group_by(Type_ox) %>%
      filter(grepl("_D_ACID", SSN) | grepl("_B_BASE", SSN)) %>%
      summarise(
        net_app_H_diff_D_B = net_app_H_max[grepl("_D_ACID", SSN)] -
                          net_app_H_max[grepl("_B_BASE", SSN)]
      ),
    by = "Type_ox"
  )

net_app_diff_df  <- net_app_diff_df %>%
  mutate(net_app_H_diff_avg_abs = abs(rowMeans(select(., starts_with("net_app_H_diff")), na.rm = TRUE)))

# net apparent difference with just acid 



 ALL_no_AL <-  ALL_no_AL %>%
  left_join(
    net_app_diff_df  %>%
      group_by(Type_ox)
  )

saveRDS(ALL_no_AL, "Titration_no_AL.RDS")

```

### 17th December Edits to Address Reviewer Comments 

\*\* edits: noted A010 instead of AO10 resulting in NA's

\*\* AO20A - used replicate data AO20B such that it registers just 1 replicate.

```{r}

##remove AL 10 since no acid titration 

df_8 <- df_8[!(df_8$SSN %in% c("AL_10_A_BASE", "AL_10_B_BASE")), ]

# Find the maximum sample number for each group
max_samples_1 <- df_8 %>%
  group_by(SSN) %>%
  summarise(
    max_sample = max(Sample, na.rm = TRUE),
    net_app_H_max = net_app_fin[which.max(Sample)]
  )


max_samples_1  <- max_samples_1  %>%
  mutate(
    Type_ox = gsub("_[A-D]_[A-Z]+$", "", SSN)  # Extract the common part of SSN
    #group_num = as.numeric(gsub("[^0-9]", "", SSN))  # Extract the numeric part of SSN
  )

# net apparent difference between acid and base 
net_app_diff_df_1 <- max_samples_1 %>%
  group_by(Type_ox) %>%
  filter(grepl("_C_ACID", SSN) | grepl("_A_BASE", SSN)) %>%
  summarise(
    net_app_H_diff_C_A = net_app_H_max[grepl("_C_ACID", SSN)] -
                      net_app_H_max[grepl("_A_BASE", SSN)]
  )

net_app_diff_df_1  <- net_app_diff_df_1  %>%
  left_join(
    max_samples_1 %>%
      group_by(Type_ox) %>%
      filter(grepl("_D_ACID", SSN) | grepl("_B_BASE", SSN)) %>%
      summarise(
        net_app_H_diff_D_B = net_app_H_max[grepl("_D_ACID", SSN)] -
                          net_app_H_max[grepl("_B_BASE", SSN)]
      ),
    by = "Type_ox"
  )

net_app_diff_df_1  <- net_app_diff_df_1 %>%
  mutate(net_app_H_diff_avg_abs = abs(rowMeans(select(., starts_with("net_app_H_diff")), na.rm = TRUE)))

# net apparent difference with just acid 



 ALL_titration_dec_2024 <-  df_8 %>%
  left_join(
    net_app_diff_df  %>%
      group_by(Type_ox)
  )

saveRDS(ALL_titration_dec_2024, "Titration_ALL.RDS")

```

#### Combining with main Isotherm DF

```{r}

ALL_Biochars<-readRDS("/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Isotherm_2/ALL_Biochars.RDS")

XPS_OC_may24 <- read_excel("/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Isotherm_2/XPS_OC.xlsx")

 main_df_XPS <-  net_app_diff_df %>%
  left_join(
    XPS_OC_may24  %>%
      group_by(Type_ox)
  )
 
  main_df <-  net_app_diff_df %>%
  left_join(
    ALL_Biochars  %>%
      group_by(Type_ox)
  )
  
# Filter the data to include only unique rows based on Type_ox
main_df <- main_df %>% distinct(Type_ox, .keep_all = TRUE)


```

## Calculating dpH, dmol

```{r}

df_8 <- df_8 %>%
  group_by(SSN) %>%
  arrange(mol_OH_or_H) %>%  # Ensure the data is sorted by mol_OH_or_H within each group
  mutate(
    delta_pH = c(NA, diff(pH)),
    delta_mol_OH_or_H = c(NA, diff(mol_OH_or_H)),
    dpH_dmol = delta_pH / delta_mol_OH_or_H
  ) %>%
  ungroup()  # Remove grouping

```

## Plots

```{r}
library(RColorBrewer)
```

### \*\* (Final) Plot of all duplicated of both acid and base titrations per SSA

```{r}
# Select only the unique values of Type_ox and SSA from main_df
main_df_unique <- main_df %>%
  select(Type_ox, SSA) %>%
  distinct()

# Perform the left join to add SSA to ALL_no_AL
ALL_no_AL <- ALL_no_AL %>%
  select(-'SSA') %>%
  left_join(main_df_unique, by = "Type_ox") %>%
  mutate( net_app_m2 = net_app_H_corrected/SSA )

plot_all_SSA <- ggplot(ALL_no_AL, aes(x = pH, y = net_app_m2, color=O_C)) +
  geom_point(shape=16, size=5) +
  #scale_color_viridis()+
  labs(#title = "Combined Acid-Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge (mmolc /m2 biochar)") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      text = element_text(family = "Helvetica"),
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 24), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =24),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank(),
       legend.position = "none"  # Remove the legend
    )+
    scale_color_gradient(low = "orange", high = "blue")

ggsave(filename = "Net_App_SSA_plot.png", plot = plot_all_SSA, width = 10, height = 8, dpi = 300)

plot_all_SSA  
```

```{r}

plot_nett_app_diff_1 <- ggplot(ALL_no_AL, aes(x = O_C, y = net_app_H_diff_avg_abs, color=Type)) +
  geom_point(size=4) +
  #scale_color_viridis()+
  labs(title = "Net Apparent Proton Charge Difference",
       x = "OC",
       y = "Net Apparent Proton Charge Difference") +
      theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis_d()
plot_nett_app_diff_1

```

```{r}
# 
# main_df_high_dose <-main_df %>%
#   filter (Dose >= 70)
# 
# main_df_high_dose$Dose <- as.factor(main_df_high_dose$Dose)
# 
# plot_nett_app_diff_2 <- ggplot(main_df_high_dose, aes(x = net_app_H_diff_avg_abs, y = XPS_OC, color=OC)) +
#   geom_point(size=4) +
#   #scale_color_viridis()+
#   labs(title = "... ",
#        x = "Net Apparent Proton Charge Differenc",
#        y = "Q_NH4") +
#       theme_bw()+
#       #eliminates background, gridlines, and chart border
#     theme(
#       panel.border = element_rect(color = "black", fill = NA, size = 3),
#       axis.text = element_text(color = "black", size = 17), 
#       axis.ticks = element_line(color = "black", size = 1),
#       axis.title = element_text(color = "black", size =20),
#         plot.background = element_blank()
#         ,panel.grid.major = element_blank()
#         ,panel.grid.minor = element_blank()
#     )+
#   scale_color_viridis()
# plot_nett_app_diff_2
```

```{r}


plot_nett_app_diff_3 <- ggplot(main_df, aes(x = net_app_H_diff_avg_abs, y = OC, color=pH)) +
  geom_point(size=4) +
  #scale_color_viridis()+
  labs(title = "... ",
       x = "Net Apparent Proton Charge Difference",
       y = "O:C") +
      theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis()
plot_nett_app_diff_3
```

### \*Bulk OC vs Net App Plot

```{r, warning=FALSE}

#main_df_high_Q <-main_df %>%
  #filter (Q_NH4_avg >= 0 & Q_NH4_avg <= 7)


plot_nett_app_diff_3B <- ggplot(main_df, aes(x = OC, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Bulk O:C",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  #xlim(0.1, 0.3) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ OC, data = main_df)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = 0.3, y = max(OC) - 0.1, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)


```

### \*Surface OC vs Net App Plot

```{r}


plot_nett_app_diff_3B <- ggplot(main_df, aes(x = XPS_OC, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface O:C",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  xlim(0.1, 0.4) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ XPS_OC, data = main_df)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = 0.4, y = max(net_app_H_diff_avg_abs) - 0.1, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)
```

### \*\* Surface C single bond O vs Net App Plot

```{r}


plot_nett_app_diff_3B <- ggplot(main_df, aes(x = C_O, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface Single Bond O",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  xlim(0.1, 0.25) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ C_O, data = main_df)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = 0.2, y = max(net_app_H_diff_avg_abs)-0.1, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)
```

### Surface Carb vs Net App Plot

```{r}

# Create the plot with the main data and linear regression line
plot_nett_app_diff_3B <- ggplot(main_df, aes(x = Carb, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface Carb",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ Carb, data = main_df)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Dynamically calculate the position for the text annotation
x_pos <- max(main_df$Carb) * 0.9  # 90% of the range of x values
y_pos <- max(main_df$net_app_H_diff_avg_abs) * 0.9  # 90% of the range of y values

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = x_pos, y = y_pos, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)


```

### \*\* Surface Carb_pi_Ksp vs Net App Plot

```{r}

# Create the plot with the main data and linear regression line
plot_nett_app_diff_3B <- ggplot(main_df, aes(x = Carb_pi_Ksp, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface Carb",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ Carb_pi_Ksp, data = main_df)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Dynamically calculate the position for the text annotation
x_pos <- max(main_df$Carb) * 0.8  # 90% of the range of x values
y_pos <- max(main_df$net_app_H_diff_avg_abs) * 0.8  # 90% of the range of y values

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = x_pos, y = y_pos, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)


```

### \*\* Surface Carb_pi_Ksp vs Net App Plot (no outlier)

```{r}

main_df_carb <- main_df %>% filter(Carb_pi_Ksp <=0.24)

# Create the plot with the main data and linear regression line
plot_nett_app_diff_3B <- ggplot(main_df_carb, aes(x = Carb_pi_Ksp, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface (C=O)-O",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ Carb_pi_Ksp, data = main_df_carb)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Dynamically calculate the position for the text annotation
x_pos <- max(main_df$Carb_pi_Ksp) * 0.75  # 90% of the range of x values
y_pos <- max(main_df$net_app_H_diff_avg_abs) * 0.95  # 90% of the range of y values

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = x_pos, y = y_pos, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)


```

Determinig if AO20 is an outlier for Net Apparent Proton Charge Difference

```{r}

#boxplot(main_df_high_dose$net_app_H_diff_avg_abs, outline = TRUE)

# Calculate Z-scores
#z_scores <- scale(main_df_high_dose$net_app_H_diff_avg_abs)
# Identify outliers
#outliers <- which(abs(z_scores) > 3)
#outliers


```

### \* Bulk OC vs Net App Plot no AO

```{r}

main_df_No_AO <-main_df %>%
  filter (Type != "AO")
```

```{r}

plot_nett_app_diff_3B <- ggplot(main_df_No_AO, aes(x = OC, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface O:C",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  xlim(0.1, 0.3) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ OC, data = main_df_No_AO)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(#x = 0.3, y = max(net_app_H_diff_avg_abs) - 0.1, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)

```

### \* Surface OC vs Net App Plot no AO

```{r, warning=FALSE}

plot_nett_app_diff_3B <- ggplot(main_df_No_AO, aes(x = XPS_OC, y = net_app_H_diff_avg_abs, color = Type)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE, linetype = "solid", color = "blue", aes(group = 1)) +
  labs(
    title = "",
    x = "Surface O:C",
    y = "Net Apparent Proton Charge Difference",
    color = "Feedstock"
  ) +
  theme_bw() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 6),
    axis.text = element_text(color = "black", size = 15),
    axis.ticks = element_line(color = "black", size = 1),
    axis.title = element_text(color = "black", size = 15),
    legend.title = element_text(color = "black", size = 15),
    legend.text = element_text(color = "black", size = 15),
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  ) +
  xlim(0.1, 0.3) +
  scale_color_viridis_d()

# Fit the linear regression model to the data
lm_model <- lm(net_app_H_diff_avg_abs ~ XPS_OC, data = main_df_No_AO)

# Summary of the regression model
summary_lm <- summary(lm_model)

# Calculate R-squared value and regression details
r_squared <- summary_lm$r.squared
p_value <- summary_lm$coefficients[2, 4]  # Extracting the p-value for the slope
equation <- paste("Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC")
significance <- ifelse(p_value < 0.001, "***", ifelse(p_value < 0.01, "**", ifelse(p_value < 0.05, "*", "ns")))

# Extract the F-statistic and degrees of freedom
f_statistic <- summary_lm$fstatistic[1]
df1 <- summary_lm$fstatistic[2]
df2 <- summary_lm$fstatistic[3]

# Extract the standard deviation of residuals
residual_sd <- sd(summary_lm$residuals)

# Output the regression details
cat("Equation: Net App H Diff =", round(coef(lm_model)[1], 2), "+", round(coef(lm_model)[2], 2), "* OC\n")
cat("R^2: ", round(r_squared, 2), "\n")
cat("p-value: ", p_value, "(", significance, ")\n")
cat("F-statistic: F(", df1, ",", df2, ") = ", round(f_statistic, 2), "\n")
cat("Standard deviation of residuals: ", round(residual_sd, 2), "\n")

# Add R-squared value, p-value, and other stats to the plot
plot_nett_app_diff_3B <- plot_nett_app_diff_3B +
  geom_text(
    aes(x = 0.28, y = max(net_app_H_diff_avg_abs) - 0.1, 
        label = paste("R^2 =", round(r_squared, 2))),
    hjust = 1, vjust = 1, color = "black", size = 6
  )

# Display the plot
print(plot_nett_app_diff_3B)
```

## Correlation Coefficient

```{r}

main_df_corr <- main_df %>% select (c("net_app_H_diff_avg_abs","XPS_OC", "O","CH",                       "C_O", "Carb","pi_pi","KsP", "Carb_pi_Ksp"))

cor_matrix <- cor(main_df_corr)
print(cor_matrix)

install.packages("corrplot")

# Load the package
library(corrplot)

# Visualize the correlation matrix
corrplot(cor_matrix, method = "circle")
```

Other

```{r}
plot_nett_app_diff_3C <- ggplot(main_df, aes(x = Dose, y = Q_NH4_avg, color=net_app_H_diff_avg_abs)) +
  geom_point(size=4) +
  
  #scale_color_viridis()+
  labs(title = "... ",
       x = "Dose",
       y = "Q_NH4") +
      theme_bw()+
      #eliminates background, gridlines, and chart border
   
   theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis()
plot_nett_app_diff_3C
```

```{r}
plot_nett_app_diff_3D <- ggplot(main_df, aes(x = NH4_Act, y = Q_NH4_avg, color=net_app_H_diff_avg_abs)) +
  geom_point(size=4) +
  #scale_color_viridis()+
  labs(title = "... ",
       x = "NH4 Equilibrium Activity",
       y = "Q_NH4 (mmol/g)") +
      theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis()
plot_nett_app_diff_3D
```

```{r}

plot_A_base <- ggplot(titr_A_base, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_A_base      
```

```{r}

plot_B_base <- ggplot(titr_B_base, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_B_base
```

```{r}

plot_C_acid <- ggplot(titr_C_acid, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Acid Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_C_acid
```

```{r}
plot_D_acid <- ggplot(titr_D_acid, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Acid Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_D_acid
```

## Removing AL from the dataframe since it behaves so differently

-   Technically, by IBI standards, it's not officially a biochar

```{r}
df_9 <-df_8 %>%
  filter (Type != "AL")
```

## \*\*\* (Final) dpH vs. d mol no AL

```{r}
df_9 <-df_8 %>%
  filter (Type != "AL")
```

```{r, warning=FALSE}

plot_all_dpH <- ggplot(df_9, aes(x = pH, y = dpH_dmol, group = SSN, color = O_C)) +
  geom_point() +
  geom_path(aes(group = SSN), size = ) +
  labs(
    x = "pH",
    y = "ΔpH / Δ mol titrant a.u.",
    color = "OC"
  ) +
  theme_classic(base_size = 30) +  # Increased base font size by 2 points
  theme(
    text = element_text(family = "Helvetica"),  # Changed font to sans-serif
    legend.position = c(0.68, 0.75),  
    axis.text.y = element_blank(),  # Remove y-axis text
    axis.ticks.y = element_blank(),  # Remove y-axis ticks
    axis.title.x = element_text(margin = margin(t = 20), size = 26),
    axis.title.y = element_text(margin = margin(r = 20), size = 26),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 22),  # Increased font size
    legend.title = element_text(size = 26),
    legend.direction = "horizontal",
    legend.key.width = unit(1.5, "cm"),
    legend.box.margin = margin(t = 5, r = 8, b = 5, l = 5),
    legend.box.background = element_rect(color = "black", size = 2, linetype = "solid")
  ) +
    theme(legend.position = "none") +
  scale_color_gradient(low = "orange", high = "blue") +
  annotate("text", x = 11, y = 8e05, label = "B", size = 10, fontface = "bold")

ggsave(filename = "dpH_pH_plot.png", plot = plot_all_dpH, width = 10, height = 8, dpi = 300)

plot_all_dpH 

```

```{r}

ALL_no_AL_dQ <-ALL_no_AL %>%
  filter (dQ_dpH < 0.2 & dQ_dpH> -0.2)


plot_all_dQ <- ggplot(ALL_no_AL_dQ, aes(x = pH, y = dQ_dpH, group =SSN, color=O_C)) +
  geom_point()+
  #geom_path(aes(group = SSN), size = 2) +
    facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dQ/dpH") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis()
 # scale_color_gradient(low = "yellow", high = "darkblue")
plot_all_dQ
```

### Second Derivative (Q vs pH) plot

```{r}

ALL_no_AL_dQ2 <-ALL_no_AL %>%
  filter (d2Q_dpH2 < 0.5 & dQ_dpH> -0.5)

plot_all_dQ2 <- ggplot(ALL_no_AL_dQ2, aes(x = pH, y = d2Q_dpH2, group =SSN, color=O_C)) +
  geom_point()+
  #geom_path(aes(group = SSN), size = 2) +
    facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "d2Q/dpH2") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_viridis()
 # scale_color_gradient(low = "yellow", high = "darkblue")
plot_all_dQ2
```

```{r}

plot_AK_all_together <- ggplot(df_9, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/ d vol titrant") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 17), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_AK_all_together
```

```{r}

ALL_Base <-df_8 %>%
  filter (AC_BA=="BASE",
          Type != "AL")

plot_ALL_Base <- ggplot(ALL_Base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  #facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = NULL) +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 10), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_ALL_Base
```

AK Base

```{r}

AK_B_base <-titr_B_base %>%
  filter (Type=="AK")

plot_B_base_dpH <- ggplot(AK_B_base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_minimal()
plot_B_base_dpH
```

AM

```{r}

AM_B_base <-titr_B_base %>%
  filter (Type=="AM")

plot_B_base_dpH <- ggplot(AM_B_base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_minimal()
plot_B_base_dpH
```

```{r}

AK_B_base <-titr_B_base %>%
  filter (Type=="AK" & SSN=="AK_05_B_BASE")

plot_B_base_dpH <- ggplot(AK_B_base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_minimal()
plot_B_base_dpH
```

```{r}
AK_D_acid <-titr_D_acid %>%
  filter (Type=="AK")

plot_D_acid_dpH <- ggplot(AK_D_acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Acid Titration",
       x = "pH",
       y = "dpH/d Vol titrant") +
  theme_minimal()
plot_D_acid_dpH
```

w/o AL

```{r}


ALL_Acid <-df_8 %>%
  filter (AC_BA=="ACID",
          Type != "AL")

plot_ALL_Acid <- ggplot(ALL_Acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  #facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
      y = "dpH/d vol titrant") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 10), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")+
  guides(color=FALSE)
     
plot_ALL_Acid
```

```{r}
plot_ALL_Acid_facet <- ggplot(ALL_Acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_ALL_Acid_facet
```

```{r}

ALL_Base <-df_8 %>%
  filter (AC_BA=="BASE",
          Type !="AL")

plot_ALL_Base_facet <- ggplot(ALL_Base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_ALL_Base_facet
```

```{r}

Acid_Base_plot <- grid.arrange(plot_ALL_Acid, plot_ALL_Base, ncol = 2)
```

```{r}

AK_D_acid <-titr_D_acid %>%
  filter (Type=="AK")

plot_D_acid_AK <- ggplot(AK_D_acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )
plot_D_acid_AK

```

AM

```{r}
AM_D_acid <-titr_D_acid %>%
  filter (Type=="AM")

plot_D_acid_AM <- ggplot(AM_D_acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )
plot_D_acid_AM
```

```{r}
AO_D_acid <-titr_D_acid %>%
  filter (Type=="AO")

plot_D_acid_AO <- ggplot(AO_D_acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )
plot_D_acid_AO
```

```{r}

AL_D_acid <-titr_D_acid %>%
  filter (Type=="AL")

plot_D_acid_AL <- ggplot(AL_D_acid, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )
plot_D_acid_AL
```

```{r}

plot_B_base_dpH <- ggplot(titr_B_base, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  labs(title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_minimal()
plot_B_base_dpH
```

```{r}

plot_all <- ggplot(df_8, aes(x = pH, y = dpH_dt, group =SSN, color=Type)) +
  geom_point()+
  #geom_line() +
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_classic2()
plot_all
```

```{r}

AK_all <- df_8 %>%
  filter (Type=="AK")

plot_AK_all <- ggplot(AK_all, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  #geom_line() +
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
  theme_classic2()
plot_AK_all
```

```{r}

AM_all_dpH <- df_8 %>%
  filter (Type=="AM")

plot_AM_all_dpH <- ggplot(AM_all_dpH, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  #facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 10), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_AM_all_dpH 
```

```{r}

AM_all_dpH <- df_8 %>%
  filter (Type=="AO")

plot_AM_all_dpH <- ggplot(AM_all_dpH, aes(x = pH, y = dpH_dt, group =SSN, color=O_C)) +
  geom_point()+
  geom_path(aes(group = SSN), size = 1) +
  #facet_wrap(~ Type, scales = "free")+ 
  labs(#title = "Base Titration",
       x = "pH",
       y = "dpH/") +
    theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
      panel.border = element_rect(color = "black", fill = NA, size = 3),
      axis.text = element_text(color = "black", size = 10), 
      axis.ticks = element_line(color = "black", size = 1),
      axis.title = element_text(color = "black", size =20),
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  scale_color_gradient(low = "yellow", high = "darkblue")
plot_AM_all_dpH 
```

```{r}
Acid_Base_plot <- grid.arrange(plot_A_base, plot_D_acid, ncol = 2)
Acid_Base_plot
```

```{r}

combined_A_D <- rbind(titr_A_base, titr_D_acid)

plot_combined_A_D <- ggplot(combined_A_D, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Acid Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_combined_A_D
```

```{r}

combined_B_C <- rbind(titr_B_base, titr_C_acid)

combined_B_C_AO <- combined_B_C %>%
  filter (Type=="AK")

plot_combined_B_C <- ggplot(combined_B_C_AO, aes(x = pH, y = net_app_H_corrected, color=O_C)) +
  geom_point() +
  scale_color_viridis()+
  labs(title = "Acid Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_combined_B_C
```

```{r}

plot_combined_B_C_AO <- ggplot(combined_B_C_AO, aes(x = pH, y = net_app_H_corrected, color=Type_ox)) +
  geom_point() +
  #scale_color_viridis()+
  labs(title = "Acid Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_combined_B_C_AO
```

```{r}

AK_Only <- df_8%>%
    filter(str_detect(SSN,"AK_")) 


plot_combined_AK <- ggplot(AK_Only, aes(x = pH, y = net_app_H_corrected, color=O_C))+ #, size = SSN)) +
  geom_point() +
    scale_color_viridis()+
  
  labs(title = "AK: Softwood Pellet Acid-Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge (mmol charge/g biochar)") +
  theme_bw()+
      #eliminates background, gridlines, and chart border
    theme(
        plot.background = element_blank()
        ,panel.grid.major = element_blank()
        ,panel.grid.minor = element_blank()
    )+
  guides(size = FALSE)
plot_combined_AK
```

```{r}

AM_Only <- df_8%>%
    filter(str_detect(SSN,"AM_")) 


plot_combined_AM <- ggplot(AM_Only, aes(x = pH, y = net_app_H_corrected, color=O_C, size = SSN)) +
  geom_point() +
  labs(title = "Acid Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_combined_AM
```

```{r}

AO_Only <- df_8%>%
    filter(str_detect(SSN,"AO_")) 

plot_combined_AO <- ggplot(AO_Only, aes(x = pH, y = net_app_H_corrected, color=O_C, size = SSN)) +
  geom_point() +
  labs(title = "Acid Base Titration",
       x = "pH",
       y = "Net Apparent Proton Charge") +
  theme_minimal()
plot_combined_AO
```
